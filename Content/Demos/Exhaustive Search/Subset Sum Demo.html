<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Subset-Sum Exhaustive-Search Demo</title>
  <!-- Include existing CSS files -->
  <link rel="stylesheet" href="/Algorithms/css/style.css">
  <link rel="stylesheet" href="/Algorithms/css/demo.css">
  <style>
   
    #summaryLabel {
      margin: 10px 0;
      font-size: 16px;
      font-weight: bold;
    }
    #solutionsLabel {
      margin: 5px 0 15px;
      font-size: 16px;
      font-style: italic;
    }
    #subsetTable {
      border-collapse: collapse;
      margin-top: 10px;
      width: auto;
    }
    #subsetTable th,
    #subsetTable td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: left;
      font-family: monospace;
    }
    #subsetTable th {
      background-color: #f0f0f0;
    }
    /* Make the "Subset" column at least 150px wide */
    #subsetTable th:nth-child(2),
    #subsetTable td:nth-child(2) {
      min-width: 150px;
    }
    /* Highlight matching rows */
    .match-row {
      background-color: lightgreen;
    }
    /* Highlight the current row */
    .current-row {
      outline: 2px solid dodgerblue;
    }
  </style>
</head>
<body>
  <h2>Subset-Sum Exhaustive-Search Demo</h2>

  <!-- Controls -->
  <div id="controls">
    <label>Set:</label>
    <input type="text" id="inputSet" value="2,5,8,11">
    <label>Target:</label>
    <input type="number" id="inputTarget" value="16">
    <button id="startBtn">Start</button>
    <button id="prevBtn" disabled>Prev</button>
    <button id="nextBtn" disabled>Next</button>
  </div>

  <!-- Summary and solutions -->
  <div id="summaryLabel"></div>
  <div id="solutionsLabel"></div>

  <!-- Table to list each subset and its sum -->
  <table id="subsetTable"></table>

  <script>
    // Globals
    let currentArray = [];
    let targetVal = 0;
    let steps = [];
    let currentIndex = -1;
    let drawnCount = 0;

    function parseSet(str) {
      return str.split(',').map(s => parseInt(s.trim(), 10)).filter(x => !isNaN(x));
    }

    function setupTable() {
      drawnCount = 0;
      currentIndex = -1;
      const table = document.getElementById('subsetTable');
      table.innerHTML = '';
      const header = document.createElement('tr');
      const thNum = document.createElement('th');
      thNum.textContent = '#';
      const thSubset = document.createElement('th');
      thSubset.textContent = 'Subset';
      const thSum = document.createElement('th');
      thSum.textContent = 'Sum';
      header.appendChild(thNum);
      header.appendChild(thSubset);
      header.appendChild(thSum);
      table.appendChild(header);
      drawnCount = 1;
    }

    function genSteps(arr) {
      steps = [];
      const n = arr.length;
      const totalMasks = 1 << n;
      for (let mask = 0; mask < totalMasks; mask++) {
        let subset = [];
        let sum = 0;
        for (let j = 0; j < n; j++) {
          if (((mask >> j) & 1) === 1) {
            subset.push(arr[j]);
            sum += arr[j];
          }
        }
        const isMatch = (sum === targetVal);
        steps.push({ mask, subset, sum, isMatch, size: subset.length });
      }
      steps.sort((a, b) => {
        if (a.size !== b.size) return a.size - b.size;
        return a.mask - b.mask;
      });
    }

    function displaySolutions() {
      const solutionsLabel = document.getElementById('solutionsLabel');
      const matches = steps.filter(s => s.isMatch).map(s => 
        s.subset.length > 0 ? `{${s.subset.join(',')}}` : `{ }`
      );
      solutionsLabel.textContent = matches.length > 0
        ? 'Solutions: ' + matches.join(', ')
        : 'No solutions found';
    }

    function renderStep(idx) {
      const table = document.getElementById('subsetTable');
      if (idx + 1 >= drawnCount) {
        const step = steps[idx];
        const row = document.createElement('tr');
        row.id = 'row-' + idx;
        if (step.isMatch) row.classList.add('match-row');

        const tdNum = document.createElement('td');
        tdNum.textContent = idx + 1;
        const tdSubset = document.createElement('td');
        tdSubset.textContent = step.subset.length > 0
          ? '{' + step.subset.join(',') + '}'
          : '{ }';
        const tdSum = document.createElement('td');
        tdSum.textContent = step.sum;

        row.appendChild(tdNum);
        row.appendChild(tdSubset);
        row.appendChild(tdSum);
        table.appendChild(row);
        drawnCount++;
      }

      const prevHighlighted = document.querySelector('.current-row');
      if (prevHighlighted) prevHighlighted.classList.remove('current-row');

      const currentRow = document.getElementById('row-' + idx);
      if (currentRow) {
        currentRow.classList.add('current-row');
        currentRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function onStart() {
      const setText = document.getElementById('inputSet').value.trim();
      const targetText = document.getElementById('inputTarget').value.trim();
      if (!setText || !targetText) {
        alert('Please enter both a set and a target.');
        return;
      }
      currentArray = parseSet(setText);
      if (currentArray.length === 0) {
        alert('Enter a valid comma-separated list of integers.');
        return;
      }
      targetVal = parseInt(targetText, 10);
      if (isNaN(targetVal)) {
        alert('Target must be a number.');
        return;
      }

      document.getElementById('summaryLabel').textContent =
        `S = { ${currentArray.join(', ')} },   Target = ${targetVal}`;

      setupTable();
      genSteps(currentArray);
      displaySolutions();

      currentIndex = 0;
      renderStep(currentIndex);
      document.getElementById('prevBtn').disabled = true;
      document.getElementById('nextBtn').disabled = (steps.length <= 1);
    }

    function onPrev() {
      if (currentIndex > 0) {
        const table = document.getElementById('subsetTable');
        const lastRow = table.lastElementChild;
        if (lastRow && lastRow.id === 'row-' + currentIndex) {
          table.removeChild(lastRow);
          drawnCount--;
        }
        currentIndex--;
        renderStep(currentIndex);
        document.getElementById('nextBtn').disabled = false;
      }
      if (currentIndex === 0) {
        document.getElementById('prevBtn').disabled = true;
      }
    }

    function onNext() {
      if (currentIndex < steps.length - 1) {
        currentIndex++;
        renderStep(currentIndex);
        document.getElementById('prevBtn').disabled = false;
      }
      if (currentIndex === steps.length - 1) {
        document.getElementById('nextBtn').disabled = true;
      }
    }

    document.getElementById('startBtn').addEventListener('click', onStart);
    document.getElementById('prevBtn').addEventListener('click', onPrev);
    document.getElementById('nextBtn').addEventListener('click', onNext);

    // Auto-run with defaults on page load
    window.addEventListener('DOMContentLoaded', onStart);
  </script>
</body>
</html>
